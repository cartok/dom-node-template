
<!-- https://benchmarkjs.com/ -->
<script src="https://cdn.jsdelivr.net/npm/lodash@4.17.11/lodash.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/platform@1.3.5/platform.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/benchmark@2.1.4/benchmark.min.js"></script>
<script>
    window.bench = new Benchmark.Suite()
        .on("start cycle", function(event){
            console.log("starting cycle")
        })
        .on("cycle", function(event){
            console.log(String(event.target))
        })
</script>

<script>
    function removeCommentsRegex(text){
        text = text.replace(/\s*(?<![\:\/])\/{2}.*$/gm, "")
        // text = text.replace(/\n/g, "")
        return text
    }
    function removeCommentsLoop(text){
        let lines = text.split("\n")
        for(let i = lines.length; i--;){
            let position = lines[i].indexOf("//")
            let found = (position !== -1)
            if(found){
                if(position > 0){
                    // skip 'https://' and 'file:///'
                    let precedingChar = lines[i].charAt(position - 1)
                    let followingChar = lines[i].charAt(position + 2)
                    let subPosition = null
                    while(precedingChar === ":"){
                        if(followingChar === "/"){
                            // continue search in substring
                            position += 3
                            subPosition = lines[i].substring(position).indexOf("//")                
                        } else {
                            // continue search in substring
                            position += 2
                            subPosition = lines[i].substring(position).indexOf("//")                
                        }
                        found = (subPosition !== -1)
                        if(found){
                            // repeat
                            position += subPosition
                            precedingChar = lines[i].charAt(position - 1)
                            followingChar = lines[i].charAt(position + 2)   
                        } else {
                            // while-loop: nothing found => finish search
                            break
                        }
                    }
                    // for-loop: nothing found after detecting https:// or file:/// => next line
                    if(!found){
                        continue
                    }
                }
                // remove comment
                lines[i] = lines[i].substring(0, position)
            }
        }
        text = lines.join("\n")
        // text = lines.join("")
        return text
    }
</script>

<script>
    const text = `
        // foo <bar></bar>
        <tag // single space
            attribute="value" // single space
            src="https://will-this-work?"        // random
            src="
                https://will-this-work?
            "
            src="https://will-this-work?" href="https://hodor-is-the-best" and="file:///home/cartok"    // works?
            > // single space
        </tag>
        <tag    // single tab
            attribute="value"   // single tab
            >    // single tab
        </tag>   // single tab
        <tag             // random
            attribute="value"         // random
            >            // random
        </tag>      // random
    // newline
    // space
        // tab
            // random


    `
</script>

<script>
    bench
        .add("remove comments (regex)", function(){
            removeCommentsRegex(text)
        })
        .add("remove comments (loop)", function(){
            removeCommentsLoop(text)
        })
        .run({ 'async': false })
</script>

<script>
    // proof
    console.log(removeCommentsRegex(text))
    console.log(removeCommentsLoop(text))
</script>


